(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{548:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(2),l=a(1),o=a(5),i=a.n(o);const s=r.a.createContext([]),p=r.a.createContext({}),m=r.a.createContext({}),u=r.a.createContext(!1);function d(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const y=({refresh:e,formGroup:t})=>r.a.createElement("a",{onClick:()=>e(),className:t?"form-group":""},r.a.createElement("span",{className:t?"flex-center-vertical":""},"Refresh",r.a.createElement("span",{className:"half-margin-left icon-refresh"})));var f=e=>{let{refresh:t,children:a}=e,n=d(e,["refresh","children"]);return r.a.createElement(l.Alert,n,a,r.a.createElement(y,{refresh:t}))};const E=({policyName:e})=>{const{values:{connection:t}}=Object(c.useFormikContext)(),[a,n]=r.a.useState({}),[l,o]=r.a.useState(!1),s=async()=>{o(!0);try{n(await(async(e,t)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/getPolicyByName`,[t],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(t,e))}catch(e){n({error:e})}finally{o(!1)}};return r.a.useEffect(()=>{s()},[]),a&&Object.keys(a).length?r.a.createElement(r.a.Fragment,null,r.a.createElement("dt",null,"Actions"),r.a.createElement("dd",null,a.error?r.a.createElement("span",{className:"text-danger"},"getPolicyByName call failed: ",Object(c.getIn)(a.error,"response.data.message",a.error.message)):a.actions.join(", "))):r.a.createElement(r.a.Fragment,null,r.a.createElement("dt",null,"Actions"),r.a.createElement("dd",null,l?"Loading details...":"No data"))},g=()=>{const{mac:e}=r.a.useContext(p),{setBlocked:t}=r.a.useContext(m),a=r.a.useContext(u),{values:{connection:n}}=Object(c.useFormikContext)(),[o,s]=r.a.useState({}),d=async()=>{t(!0);try{s(await(async(e,t)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/getEndpointByMac`,[t],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(n,e))}catch(e){s({error:e})}finally{t(!1)}};return r.a.useEffect(()=>{n&&d()},[n]),a?r.a.createElement(l.Spinner,null):n?o&&Object.keys(o).length?o.error?r.a.createElement(l.Alert,{type:"error",title:"Operation failed"},"getEndpointByMac call failed: ",Object(c.getIn)(o.error,"response.data.message",o.error.message)):r.a.createElement("div",{className:"panel panel--bordered half-margin-top"},r.a.createElement("h4",null,"Policy Details"),r.a.createElement("dl",{className:"dl--inline-wrap half-margin-bottom"},r.a.createElement("dt",null,"Name"),r.a.createElement("dd",null,o.policyName),r.a.createElement(E,{policyName:o.policyName})),r.a.createElement(y,{refresh:d})):r.a.createElement(f,{title:"No policies applied",refresh:d},r.a.createElement("p",null,`No policies applied to the EP ${e}.`)):null};var b=a(3),h=a.n(b);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function x(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const j=e=>{let{policies:t}=e,a=x(e,["policies"]);return r.a.useContext(u)&&(a.disabled=!0),r.a.useEffect(()=>()=>{a.form.setFieldValue("policy","",!1)},[]),r.a.createElement(l.Select,v({title:"Policy",prompt:"Select policy",id:"policy-selector"},a),t.map(e=>r.a.createElement("option",{id:e.name,value:e.name,key:e.name},`${e.name} (actions: ${e.actions.join("; ")})`)))},O=({applyCallback:e,applying:t,applyText:a,policy:n})=>{const c={};return t&&(c.disabled="disabled"),a&&Array.isArray(a)||(a=["Apply","Applying"]),r.a.createElement("a",v({className:"form-group",onClick:()=>e(n)},c),r.a.createElement("span",{className:"flex-center-vertical"},t?a[1]:a[0],r.a.createElement("span",{className:`half-margin-left ${t?"icon-animation spin":"icon-check"}`})))},C=({applyCallback:e,applying:t,applyText:a})=>{const{values:{connection:n}}=Object(c.useFormikContext)(),{setBlocked:o}=r.a.useContext(m),s=r.a.useContext(u),[p,d]=r.a.useState({}),[E,g]=r.a.useState(""),b=async()=>{g(""),o(!0);try{const e=await(async e=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/getPolicies`,[],{headers:{Accept:"application/json"}})).data})(n);d(e)}catch(e){d({error:e})}finally{o(!1)}},h=e=>{e&&e!==E&&g(e)};return r.a.useEffect(()=>{n&&b()},[n]),s?r.a.createElement(l.Spinner,null):p&&Object.keys(p).length?p.error?r.a.createElement(l.Alert,{type:"error",title:"Operation failed"},"getPolicies call failed: ",p.error.message):r.a.createElement(r.a.Fragment,null,r.a.createElement(c.Field,{component:j,name:"policy",policies:p.policies,validate:h}),r.a.createElement("div",{className:"half-margin-top flex-center-vertical flex"},r.a.createElement(y,{refresh:b,formGroup:!0}),E&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"divider"}),r.a.createElement(O,{applyCallback:e,applying:t,policy:E,applyText:a})))):r.a.createElement(f,{title:"No policies",refresh:b},r.a.createElement("p",null,"No policies configured."))},w=({response:e})=>e?e.error?r.a.createElement(l.Alert,{type:"error",title:"Operation failed",className:"half-margin-top"},"Call failed: ",Object(c.getIn)(e.error,"response.data.message",e.error.message)):r.a.createElement("div",{className:"panel panel--bordered half-margin-top"},r.a.createElement("h4",null,"Latest Response"),r.a.createElement("dl",{className:"dl--inline-wrap half-margin-bottom"},Object.keys(e).map(t=>r.a.createElement(r.a.Fragment,{key:t},r.a.createElement("dt",null,t),r.a.createElement("dd",null,e[t]))))):null,N=({by:e})=>{const{values:{connection:t},setFieldValue:a,setFieldTouched:n}=Object(c.useFormikContext)(),{mac:l,ipAddr:o}=r.a.useContext(p),[s,m]=r.a.useState(!1),[u,d]=r.a.useState(null);if(r.a.useEffect(()=>{a(e,"mac"===e?l:o,!1),n(e,!0,!1)},[]),t){const a=async a=>{try{let n;m(!0),d(null),n="ip"===e?await(async(e,t,a)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/applyEndpointByIp`,[t,a],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(t,o,a):await(async(e,t,a)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/applyEndpointByMac`,[t,a],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(t,l,a),d(n)}catch(e){d({error:e})}finally{m(!1)}};return r.a.createElement(r.a.Fragment,null,r.a.createElement(C,{applyCallback:a,applying:s}),r.a.createElement(w,{response:u}))}return null};N.propTypes={by:h.a.oneOf(["ip","mac"]).isRequired};const k=({by:e})=>{const{values:{connection:t},setFieldValue:a,setFieldTouched:n}=Object(c.useFormikContext)(),{mac:l,ipAddr:o}=r.a.useContext(p),[s,m]=r.a.useState(!1),[u,d]=r.a.useState(null);if(r.a.useEffect(()=>{a(e,"mac"===e?l:o,!1),n(e,!0,!1)},[]),t){const a=async a=>{try{let n;m(!0),d(null),n="ip"===e?await(async(e,t,a)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/clearEndpointByIp`,[t,a],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(t,o,a):await(async(e,t,a)=>{return(await i.a.post(`/pxgrid/connections/${e}/service/com.cisco.ise.config.anc/clearEndpointByMac`,[t,a],{headers:{Accept:"application/json","Content-Type":"application/json"}})).data})(t,l,a),d(n)}catch(e){d({error:e})}finally{m(!1)}};return r.a.createElement(r.a.Fragment,null,r.a.createElement(C,{applyCallback:a,applying:s,applyText:["Clear","Clearing"]}),r.a.createElement(w,{response:u}))}return null};function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}k.propTypes={by:h.a.oneOf(["ip","mac"]).isRequired};const S=e=>{const t=r.a.useContext(s),a=r.a.useContext(u);return r.a.createElement(l.Select,A({title:"Connection",prompt:"Select connection",id:"connection-selector",disabled:a},e),t.map(e=>{const t={};return"ENABLED"!==e.attributes.state&&(t.disabled="disabled"),r.a.createElement("option",A({id:e.id,value:e.id,key:e.id},t),e.friendlyName,t.disabled?" (not enabled)":"")}))};function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}const P={getEndpointByMac:e=>r.a.createElement(g,e),applyEndpointByIp:e=>r.a.createElement(N,F({by:"ip"},e)),applyEndpointByMac:e=>r.a.createElement(N,F({by:"mac"},e)),clearEndpointByIp:e=>r.a.createElement(k,F({by:"ip"},e)),clearEndpointByMac:e=>r.a.createElement(k,F({by:"mac"},e))},B=({api:e})=>e?r.a.createElement(c.Formik,{initialValues:{connection:""},onSubmit:(e,{setSubmitting:t})=>{t(!1)}},t=>r.a.createElement(c.Form,null,r.a.createElement(c.Field,{component:S,name:"connection"}),P[e]({formik:t}))):null;t.default=({session:e,api:t})=>{const[a,n]=r.a.useState(null),[c,o]=r.a.useState(!1);let d;return r.a.useEffect(()=>{(async()=>{return(await i.a.get("/pxgrid/connections/get-connections",{headers:{Accept:"application/json"}})).data})().then(e=>n(e.filter(e=>"__new-connection"!==e.id))).catch(e=>{l.toast.error("Error",e.message,!1),console.error(e)})},[]),d=Array.isArray(a)&&a.length?r.a.createElement(B,{api:t}):Array.isArray(a)&&!a.length?r.a.createElement(l.Alert,{title:"No pxGrid connections"},"No pxGrid connections found. Please create a connection on a ",r.a.createElement("a",{href:"/pxgrid/"},"pxGrid")," page first."):r.a.createElement(l.Spinner,null),r.a.createElement(m.Provider,{value:{setBlocked:o}},r.a.createElement(u.Provider,{value:c},r.a.createElement(p.Provider,{value:e},r.a.createElement(s.Provider,{value:a},d))))}}}]);